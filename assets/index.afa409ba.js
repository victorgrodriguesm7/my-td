var A=Object.defineProperty;var m=(r,t,e)=>t in r?A(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>(m(r,typeof t!="symbol"?t+"":t,e),e);const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerpolicy&&(h.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?h.credentials="include":i.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=e(i);fetch(i.href,h)}};p();class w{constructor(t){n(this,"canvas");n(this,"context");n(this,"screenSize");n(this,"components",[]);this.canvas=t,this.context=t.getContext("2d"),this.screenSize={width:t.width,height:t.height}}addComponent(t){this.components.push(t)}clearCanvas(){const{width:t,height:e}=this.screenSize;this.context.clearRect(0,0,t,e)}run(){const e=16.666666666666668;let i=Date.now();const h=()=>{requestAnimationFrame(h);const o=Date.now(),a=o-i;if(a>e){this.clearCanvas(),i=o-a%e;const d={components:this.components,screenSize:this.screenSize,context:this.context,deltaTime:a};for(const l of this.components)l.update(d)}};h()}}class f{constructor(){n(this,"canvas");n(this,"listeners",{})}init(t){this.canvas=t,t.addEventListener("click",this.handleClick.bind(this))}static get instance(){return this._instance||(this._instance=new this)}getCursorPosition(t){if(this.canvas){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top;return{x:s,y:i}}throw new Error("InputHandlerError: Canvas not defined")}handleClick(t){const{x:e,y:s}=this.getCursorPosition(t),i=this.listeners.click;if(!!i)for(const h of i)h({type:"click",x:e,y:s})}addListener({event:t,strategy:e="none",component:s,callback:i}){var o;this.listeners[t]||(this.listeners[t]=[]),i=i.bind(s);const h=a=>{const{type:d,x:l,y:u}=a;(e==="none"||e==="hitbox"&&d==="click"&&typeof l!="undefined"&&typeof u!="undefined"&&s.x<l&&s.x+s.width<l&&s.y<u&&s.y+s.height>u)&&i(a)};(o=this.listeners[t])==null||o.push(h)}}n(f,"_instance");function x({origin:r,target:t}){return Math.atan2(r.y-t.y,r.x-t.x)*180/Math.PI}var C={between:x};function g(r){return{x:r.x+r.width/2,y:r.y+r.height/2}}class y{constructor({height:t,width:e,x:s,y:i}){n(this,"height");n(this,"width");n(this,"x");n(this,"y");this.height=t,this.width=e,this.x=s,this.y=i}update(t){}}class S{constructor({x:t,y:e,width:s,height:i,firerate:h,radius:o}){n(this,"x");n(this,"y");n(this,"width");n(this,"height");n(this,"firerate");n(this,"radius");n(this,"lastShoot",0);n(this,"selected",!1);n(this,"targetAngle",0);n(this,"currentAngle",0);n(this,"level",1);n(this,"MAX_LEVEL",3);this.x=t,this.y=e,this.width=s,this.height=i,this.firerate=h,this.radius=o}findNearestEnemy(t){let e=null;for(let s of t)if(s instanceof y){const i=Math.sqrt((this.x-s.x)**2+(this.y-s.y)**2);this.radius>=i&&(e&&e.distance>i&&(e={distance:i,enemy:s}),e={distance:i,enemy:s})}return e}canShoot(){const t=Date.now(),e=1e3/this.firerate;return t-this.lastShoot>e}findAngle(t){const e={turret:g(this),enemy:g(t)},s=C.between({origin:e.turret,target:e.enemy});s<0?this.targetAngle=s+360:this.targetAngle=s}aim(){if(Math.round(this.currentAngle)===Math.round(this.targetAngle))return;const e=this.targetAngle-this.currentAngle,s=Math.min(360-Math.abs(e),360);e<0&&Math.abs(e)<s?this.currentAngle<0?this.currentAngle=360:this.currentAngle-=1:s<=e?this.currentAngle<0?this.currentAngle=360:this.currentAngle-=1:this.currentAngle>360?this.currentAngle=0:this.currentAngle+=1}showRadius(t){t.beginPath(),t.lineWidth=1,t.strokeStyle="rgba(52, 152, 219, 0.5)",t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.stroke()}update(t){}}var v="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABAklEQVQ4jcWSrUtDURjGf/dy9r+YTMK44WC4kxM07CArIhg2wTLbWLALsrYkbAsDq8ywIri0sGLxI9gMC2vW2/YuzHO53svclSF72oH395zn/YBty8tZJ6uYdQYCMOy3eXl/A+Cq1fnB/WYgSbC0BHlqnGdMBMAaLXlkjRZrtHxz4iX7s0azt7uzpiv4nH1RPtjn6OwSZ+BZo8XBz68fzEcTAPwwoHpS4fCiyTSKmAHFhJlKz8HBD4UC0yiiPprQA7i9iedRSyRQLkE6pvstrVKrQxHo3t0vE7pBDh7HcZEfBtSV4lop/DDImNROjxn22/F74y2sUq47+NdLzBj9kcmnBTtLtfXgWyrLAAAAAElFTkSuQmCC";class E extends S{constructor({x:t,y:e}){super({x:t,y:e,height:16,width:16,radius:100,firerate:10});n(this,"i",0);this.targetAngle=180}draw(t){t.fillStyle="#0F0";const e=document.createElement("img");e.src=v,t.fillRect(this.x,this.y,this.width,this.height),t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.currentAngle*Math.PI/180),t.translate(-this.x-this.width/2,-this.y-this.height/2),t.drawImage(e,this.x,this.y),t.restore(),this.i++}update(t){const{context:e,components:s}=t;if(this.canShoot()){const i=this.findNearestEnemy(s);if(i){const{enemy:h}=i;this.findAngle(h),this.aim()}}this.draw(e)}}class L extends y{constructor({width:t,height:e,x:s,y:i}){super({width:t,height:e,x:s,y:i});f.instance.addListener({event:"click",callback:this.onClick,component:this})}onClick(t){typeof t.x!="undefined"&&typeof t.y!="undefined"&&(this.x=t.x,this.y=t.y)}update({context:t}){t.fillRect(this.x,this.y,this.width,this.height)}}const c=document.querySelector("canvas");if(c){c.width=320,c.height=320;const r=new w(c);f.instance.init(c);const e=new E({x:c.width/2,y:c.height/2}),s=new L({width:10,height:10,x:20,y:0});r.addComponent(e),r.addComponent(s),r.run()}
